"use strict";//
//    _____________  ____    __________  ____      _________________________
//   / ___/_  __/\ \/ / /   / ____/ __ \/ __ )    / / ____/ ____/_  __/ ___/
//   \__ \ / /    \  / /   / __/ / / / / __  |_  / / __/ / /     / /  \__ \
//  ___/ // /     / / /___/ /___/ /_/ / /_/ / /_/ / /___/ /___  / /  ___/ /
// /____//_/     /_/_____/_____/\____/_____/\____/_____/\____/ /_/  /____/
//
//  special thanks to Raphael Amorim (@raphamorim) for the core concept,
//  because this is basicly a remake of nativeCSS (https://github.com/raphamorim/native-css)
//
Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _fs=_interopRequireDefault(require("fs")),_css=_interopRequireDefault(require("css")),_fetch=require("fetch"),_transformRules=_interopRequireDefault(require("./lib/transformRules.js"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var styleObjects=/*#__PURE__*/function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"indentObject",value:function d(a,b){var c=this;return JSON.stringify(a,null,b||0)}},{key:"nameGenerator",value:function b(a){return a=a.replace(/\s\s+/g," "),a=a.replace(/[^a-zA-Z0-9]/g,"_"),a=a.replace(/^_+/g,""),a=a.replace(/_+$/g,""),a}},{key:"mediaNameGenerator",value:function b(a){return"@media "+a}},{key:"transform",value:function c(a){var b={};return(0,_transformRules.default)(this,a.stylesheet.rules,b),b}},{key:"isUrl",value:function c(a){// feel free to use a better pattern
var b=/^(?:(?:http|https|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?:(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[0-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))|localhost)(?::\d{2,5})?(?:(\/|\?|#)[^\s]*)?$/i;return!!b.test(a)}},{key:"fetchUrlAsync",value:function b(a){return new Promise(function(b,c){(0,_fetch.fetchUrl)(a,function(a,d,e){if(a)throw a;try{b(e.toString())}catch(a){c(a)}})})}},{key:"convertAsync",value:function d(a){var b=this,c=process.cwd()+"/"+a;return new Promise(function(d,e){if(!b.isUrl(a)){if(require("fs").existsSync(c)){var f=_fs.default.readFileSync(c,"utf-8");return f=_css.default.parse(f,{silent:!1,source:c}),d(b.transform.apply(b,f))}e(new Error("Ooops!\nError: CSS file not found!"))}else return b.fetchUrlAsync(a).catch(function(a){e(a)}).then(function(a){var a=_css.default.parse(a,{silent:!1,source:c});d(b.transform(a))})})}},{key:"convert",value:function e(a){var b,c=this,d=a;// PATH given
if(require("fs").existsSync(d))b=_fs.default.readFileSync(d,"utf-8");// STRING given
else if("string"==typeof a){// TBD: refactor file/string verification
if(!~a.indexOf("{"))return"Ooops!\nError: CSS file not found!";b=a}// Buffer given
else if(a instanceof Buffer)b=a.toString();// URL given
else return this.isUrl(a)?this.convertAsync(a):"Ooops!\nError: CSS file not found!";return b=_css.default.parse(b,{silent:!1,source:d}),c.transform(b)}},{key:"generateFile",value:function f(a,b,c){if(!b||-1<b.indexOf("--"))return console.log("Please, set a output path!");var d,e=transformhis;return c?(_fs.default.writeFileSync(b,"var styles = StyleSheet.create({\n"),d=e.indentObject(a,2),void _fs.default.appendFileSync(b,d+"\n})")):void(d=e.indentObject({styles:a},2),_fs.default.writeFileSync(b,d))}}]),a}(),_default=new styleObjects;exports.default=_default;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPLENBQUMsR0FBUixDQUFZLDRCQUFaLENBQVAsQ0FFRixHQUNFLENBQUEsQ0FERixDQUFJLENBQUksQ0FBRyxZQUFYLENBSitCLE1BTzNCLENBQUEsQ0FQMkIsRUFRN0IsWUFBRyxhQUFILENBQWlCLENBQWpCLENBQXdCLG9DQUF4QixDQVI2QixDQVM3QixDQUFJLENBQUcsQ0FBSSxDQUFDLFlBQUwsQ0FBa0IsQ0FBbEIsQ0FBdUIsQ0FBdkIsQ0FUc0IsS0FVN0IsYUFBRyxjQUFILENBQWtCLENBQWxCLENBQXlCLENBQUksQ0FBRyxNQUFoQyxDQVY2QixPQWMvQixDQUFJLENBQUcsQ0FBSSxDQUFDLFlBQUwsQ0FBa0IsQ0FDdkIsT0FBVSxDQURhLENBQWxCLENBRUosQ0FGSSxDQWR3QixDQWtCL0IsWUFBRyxhQUFILENBQWlCLENBQWpCLENBQXdCLENBQXhCLENBbEIrQixDQW1CaEMsQyxrQkFHVyxHQUFJLENBQUEsWSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xuLy9cbi8vICAgIF9fX19fX19fX19fX18gIF9fX18gICAgX19fX19fX19fXyAgX19fXyAgICAgIF9fX19fX19fX19fX19fX19fX19fX19fX19cbi8vICAgLyBfX18vXyAgX18vXFwgXFwvIC8gLyAgIC8gX19fXy8gX18gXFwvIF9fICkgICAgLyAvIF9fX18vIF9fX18vXyAgX18vIF9fXy9cbi8vICAgXFxfXyBcXCAvIC8gICAgXFwgIC8gLyAgIC8gX18vIC8gLyAvIC8gX18gIHxfICAvIC8gX18vIC8gLyAgICAgLyAvICBcXF9fIFxcXG4vLyAgX19fLyAvLyAvICAgICAvIC8gL19fXy8gL19fXy8gL18vIC8gL18vIC8gL18vIC8gL19fXy8gL19fXyAgLyAvICBfX18vIC9cbi8vIC9fX19fLy9fLyAgICAgL18vX19fX18vX19fX18vXFxfX19fL19fX19fL1xcX19fXy9fX19fXy9cXF9fX18vIC9fLyAgL19fX18vXG4vL1xuLy8gIHNwZWNpYWwgdGhhbmtzIHRvIFJhcGhhZWwgQW1vcmltIChAcmFwaGFtb3JpbSkgZm9yIHRoZSBjb3JlIGNvbmNlcHQsXG4vLyAgYmVjYXVzZSB0aGlzIGlzIGJhc2ljbHkgYSByZW1ha2Ugb2YgbmF0aXZlQ1NTIChodHRwczovL2dpdGh1Yi5jb20vcmFwaGFtb3JpbS9uYXRpdmUtY3NzKVxuLy9cblxuaW1wb3J0IGZzICAgICAgICAgICAgICAgZnJvbSAnZnMnXG5pbXBvcnQgY3NzUGFyc2VyICAgICAgICBmcm9tICdjc3MnXG5pbXBvcnQge2ZldGNoVXJsfSAgICAgICBmcm9tICdmZXRjaCdcblxuaW1wb3J0IHRyYW5zZm9ybVJ1bGVzICAgZnJvbSAnLi9saWIvdHJhbnNmb3JtUnVsZXMuanMnXG5cbmNsYXNzIHN0eWxlT2JqZWN0cyB7XG5cbiAgICBpbmRlbnRPYmplY3QgKG9iaiwgaW5kZW50KSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIHJlc3VsdCA9ICcnXG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCBpbmRlbnQgfHwgMClcbiAgICB9XG5cbiAgICBuYW1lR2VuZXJhdG9yIChuYW1lKSB7XG4gICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9cXHNcXHMrL2csICcgJylcbiAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCAnXycpXG4gICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9eXysvZywgJycpXG4gICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9fKyQvZywgJycpXG4gICAgICByZXR1cm4gbmFtZVxuICAgIH1cblxuICAgIG1lZGlhTmFtZUdlbmVyYXRvciAobmFtZSkge1xuICAgICAgcmV0dXJuICdAbWVkaWEgJyArIG5hbWVcbiAgICB9XG5cbiAgICB0cmFuc2Zvcm0gKGNzcykge1xuICAgICAgdmFyIHJlc3VsdCA9IHt9XG4gICAgICB0cmFuc2Zvcm1SdWxlcyh0aGlzLCBjc3Muc3R5bGVzaGVldC5ydWxlcywgcmVzdWx0KVxuICAgICAgcmV0dXJuIHJlc3VsdFxuICAgIH1cblxuICAgIGlzVXJsIChzdHIpIHtcbiAgICAgIC8vIGZlZWwgZnJlZSB0byB1c2UgYSBiZXR0ZXIgcGF0dGVyblxuICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKCdeKD86KD86aHR0cHxodHRwc3xmdHApOi8vKSg/OlxcXFxTKyg/OjpcXFxcUyopP0ApPyg/Oig/Oig/OlsxLTldXFxcXGQ/fDFcXFxcZFxcXFxkfDJbMDFdXFxcXGR8MjJbMC0zXSkoPzpcXFxcLig/OjE/XFxcXGR7MSwyfXwyWzAtNF1cXFxcZHwyNVswLTVdKSl7Mn0oPzpcXFxcLig/OlswLTldXFxcXGQ/fDFcXFxcZFxcXFxkfDJbMC00XVxcXFxkfDI1WzAtNF0pKXwoPzooPzpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZjAtOV0rLT8pKlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XSspKD86XFxcXC4oPzpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZjAtOV0rLT8pKlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XSspKig/OlxcXFwuKD86W2EtelxcXFx1MDBhMS1cXFxcdWZmZmZdezIsfSkpKXxsb2NhbGhvc3QpKD86OlxcXFxkezIsNX0pPyg/OigvfFxcXFw/fCMpW15cXFxcc10qKT8kJywgJ2knKVxuICAgICAgaWYgKCFwYXR0ZXJuLnRlc3Qoc3RyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgZmV0Y2hVcmxBc3luYyAoY3NzRmlsZSkge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmZXRjaFVybChjc3NGaWxlLCBmdW5jdGlvbihlcnIsIG1ldGEsIGJvZHkpIHtcbiAgICAgICAgICBpZiAoZXJyKSB0aHJvdyBlcnJcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmVzb2x2ZShib2R5LnRvU3RyaW5nKCkpXG4gICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29udmVydEFzeW5jIChjc3NGaWxlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgIHBhdGggPSBwcm9jZXNzLmN3ZCgpICsgJy8nICsgY3NzRmlsZSxcbiAgICAgICAgZXJyb3JcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBpZiAoIXNlbGYuaXNVcmwoY3NzRmlsZSkpIHtcbiAgICAgICAgICBpZiAoKHJlcXVpcmUoJ2ZzJykuZXhpc3RzU3luYyhwYXRoKSkpIHtcbiAgICAgICAgICAgIHZhciBjc3MgPSBmcy5yZWFkRmlsZVN5bmMocGF0aCwgJ3V0Zi04JylcbiAgICAgICAgICAgIGNzcyA9IGNzc1BhcnNlci5wYXJzZShjc3MsIHtcbiAgICAgICAgICAgICAgc2lsZW50OiBmYWxzZSxcbiAgICAgICAgICAgICAgc291cmNlOiBwYXRoXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoc2VsZi50cmFuc2Zvcm0uYXBwbHkoc2VsZiwgY3NzKSlcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignT29vcHMhXFxuRXJyb3I6IENTUyBmaWxlIG5vdCBmb3VuZCEnKSlcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuZmV0Y2hVcmxBc3luYyhjc3NGaWxlKVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNzcykge1xuICAgICAgICAgICAgICB2YXIgY3NzID0gY3NzUGFyc2VyLnBhcnNlKGNzcywge1xuICAgICAgICAgICAgICAgIHNpbGVudDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc291cmNlOiBwYXRoXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIHJlc29sdmUoc2VsZi50cmFuc2Zvcm0oY3NzKSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29udmVydCAoY3NzRmlsZSkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBwYXRoID0gY3NzRmlsZSxcbiAgICAgICAgY3NzXG5cbiAgICAgIC8vIFBBVEggZ2l2ZW5cbiAgICAgIGlmICgocmVxdWlyZSgnZnMnKS5leGlzdHNTeW5jKHBhdGgpKSkge1xuICAgICAgICBjc3MgPSBmcy5yZWFkRmlsZVN5bmMocGF0aCwgJ3V0Zi04JylcbiAgICAgIH1cbiAgICAgIC8vIFNUUklORyBnaXZlblxuICAgICAgZWxzZSBpZiAodHlwZW9mIGNzc0ZpbGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIFRCRDogcmVmYWN0b3IgZmlsZS9zdHJpbmcgdmVyaWZpY2F0aW9uXG4gICAgICAgIGlmICghfmNzc0ZpbGUuaW5kZXhPZigneycpKSB7XG4gICAgICAgICAgcmV0dXJuICdPb29wcyFcXG5FcnJvcjogQ1NTIGZpbGUgbm90IGZvdW5kISdcbiAgICAgICAgfVxuICAgICAgICBjc3MgPSBjc3NGaWxlXG4gICAgICB9XG4gICAgICAvLyBCdWZmZXIgZ2l2ZW5cbiAgICAgIGVsc2UgaWYgKGNzc0ZpbGUgaW5zdGFuY2VvZiBCdWZmZXIpIHtcbiAgICAgICAgY3NzID0gY3NzRmlsZS50b1N0cmluZygpXG4gICAgICB9XG4gICAgICAvLyBVUkwgZ2l2ZW5cbiAgICAgIGVsc2UgaWYgKHRoaXMuaXNVcmwoY3NzRmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydEFzeW5jKGNzc0ZpbGUpXG4gICAgICB9XG4gICAgICAvLyB1bmtub3duIGZvcm1hdFxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAnT29vcHMhXFxuRXJyb3I6IENTUyBmaWxlIG5vdCBmb3VuZCEnXG4gICAgICB9XG5cblxuICAgICAgY3NzID0gY3NzUGFyc2VyLnBhcnNlKGNzcywge1xuICAgICAgICBzaWxlbnQ6IGZhbHNlLFxuICAgICAgICBzb3VyY2U6IHBhdGhcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiBzZWxmLnRyYW5zZm9ybShjc3MpXG4gICAgfVxuXG4gICAgZ2VuZXJhdGVGaWxlIChvYmosIHdoZXJlLCByZWFjdCkge1xuICAgICAgaWYgKCF3aGVyZSB8fCB3aGVyZS5pbmRleE9mKCctLScpID4gLTEpXG4gICAgICAgIHJldHVybiBjb25zb2xlLmxvZygnUGxlYXNlLCBzZXQgYSBvdXRwdXQgcGF0aCEnKVxuXG4gICAgICB2YXIgc2VsZiA9IHRyYW5zZm9ybWhpcyxcbiAgICAgICAgYm9keVxuXG4gICAgICBpZiAocmVhY3QpIHtcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyh3aGVyZSwgJ3ZhciBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XFxuJylcbiAgICAgICAgYm9keSA9IHNlbGYuaW5kZW50T2JqZWN0KG9iaiwgMilcbiAgICAgICAgZnMuYXBwZW5kRmlsZVN5bmMod2hlcmUsIGJvZHkgKyAnXFxufSknKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgYm9keSA9IHNlbGYuaW5kZW50T2JqZWN0KHtcbiAgICAgICAgJ3N0eWxlcyc6IG9ialxuICAgICAgfSwgMilcblxuICAgICAgZnMud3JpdGVGaWxlU3luYyh3aGVyZSwgYm9keSlcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IChuZXcgc3R5bGVPYmplY3RzKCkpXG4iXX0=